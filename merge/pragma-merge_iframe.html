<!DOCTYPE html> 
<html>
  <head>

    <meta name="viewport" content="user-scalable=1.0,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 

    <title id='title'>Merge/Diff</title>
    
    
    <link rel="stylesheet" href="node_modules/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="node_modules/codemirror/addon/merge/merge.css">
        

  
    <script src="node_modules/codemirror/lib/codemirror.js"></script>
    <script src="node_modules/codemirror/mode/meta.js"></script>   <!-- Used to map file-extension to mime-->    
    <script src="node_modules/diff-match-patch/index.js"></script>
    <script src="node_modules/codemirror/addon/merge/merge.js"></script>
    
    <script src="pragma-merge.js"></script>
    <link rel="stylesheet" type="text/css" href="../color_styles.css" />   

    
    <!-- Read in all language modes-->    
    
    <script src="node_modules/codemirror/addon/mode/simple.js"></script>
    
    <script src="node_modules/codemirror/mode/xml/xml.js"></script>
    <script src="node_modules/codemirror/mode/css/css.js"></script>
    <script src="node_modules/codemirror/mode/javascript/javascript.js"></script>
    <script src="node_modules/codemirror/mode/htmlmixed/htmlmixed.js"></script>
    <script src="node_modules/codemirror/mode/clike/clike.js"></script>
    <script src="node_modules/codemirror/mode/octave/octave.js"></script>
    <script src="node_modules/codemirror/mode/python/python.js"></script>
        
        
    <script src='node_modules/codemirror/mode/apl/apl.js'></script>
    <script src='node_modules/codemirror/mode/asciiarmor/asciiarmor.js'></script>
    <script src='node_modules/codemirror/mode/asn.1/asn.1.js'></script>
    <script src='node_modules/codemirror/mode/asterisk/asterisk.js'></script>
    <script src='node_modules/codemirror/mode/brainfuck/brainfuck.js'></script>
    <script src='node_modules/codemirror/mode/clike/clike.js'></script>
    <script src='node_modules/codemirror/mode/clojure/clojure.js'></script>
    <script src='node_modules/codemirror/mode/cmake/cmake.js'></script>
    <script src='node_modules/codemirror/mode/cobol/cobol.js'></script>
    <script src='node_modules/codemirror/mode/coffeescript/coffeescript.js'></script>
    <script src='node_modules/codemirror/mode/commonlisp/commonlisp.js'></script>
    <script src='node_modules/codemirror/mode/crystal/crystal.js'></script>
    <script src='node_modules/codemirror/mode/css/css.js'></script>
    <script src='node_modules/codemirror/mode/cypher/cypher.js'></script>
    <script src='node_modules/codemirror/mode/d/d.js'></script>
    <script src='node_modules/codemirror/mode/dart/dart.js'></script>
    <script src='node_modules/codemirror/mode/diff/diff.js'></script>
    <script src='node_modules/codemirror/mode/django/django.js'></script>
    
    <script src='node_modules/codemirror/mode/dockerfile/dockerfile.js'></script>
    
    <script src='node_modules/codemirror/mode/dtd/dtd.js'></script>
    <script src='node_modules/codemirror/mode/dylan/dylan.js'></script>
    <script src='node_modules/codemirror/mode/ebnf/ebnf.js'></script>
    <script src='node_modules/codemirror/mode/ecl/ecl.js'></script>
    <script src='node_modules/codemirror/mode/eiffel/eiffel.js'></script>
    <script src='node_modules/codemirror/mode/elm/elm.js'></script>
    <script src='node_modules/codemirror/mode/erlang/erlang.js'></script>

    <script src='node_modules/codemirror/mode/factor/factor.js'></script>

    <script src='node_modules/codemirror/mode/fcl/fcl.js'></script>
    <script src='node_modules/codemirror/mode/forth/forth.js'></script>
    <script src='node_modules/codemirror/mode/fortran/fortran.js'></script>
    <script src='node_modules/codemirror/mode/gas/gas.js'></script>
    <script src='node_modules/codemirror/mode/gfm/gfm.js'></script>
    <script src='node_modules/codemirror/mode/gherkin/gherkin.js'></script>
    <script src='node_modules/codemirror/mode/go/go.js'></script>
    <script src='node_modules/codemirror/mode/groovy/groovy.js'></script>
    <script src='node_modules/codemirror/mode/haml/haml.js'></script>
    <script src='node_modules/codemirror/mode/haskell/haskell.js'></script>
    <script src='node_modules/codemirror/mode/haskell-literate/haskell-literate.js'></script>
    <script src='node_modules/codemirror/mode/haxe/haxe.js'></script>
    <script src='node_modules/codemirror/mode/htmlembedded/htmlembedded.js'></script>
    <script src='node_modules/codemirror/mode/htmlmixed/htmlmixed.js'></script>
    <script src='node_modules/codemirror/mode/http/http.js'></script>
    <script src='node_modules/codemirror/mode/idl/idl.js'></script>
    <script src='node_modules/codemirror/mode/javascript/javascript.js'></script>
    <script src='node_modules/codemirror/mode/jinja2/jinja2.js'></script>
    <script src='node_modules/codemirror/mode/jsx/jsx.js'></script>
    <script src='node_modules/codemirror/mode/julia/julia.js'></script>
    <script src='node_modules/codemirror/mode/livescript/livescript.js'></script>
    <script src='node_modules/codemirror/mode/lua/lua.js'></script>
    <script src='node_modules/codemirror/mode/markdown/markdown.js'></script>
    <script src='node_modules/codemirror/mode/mathematica/mathematica.js'></script>
    <script src='node_modules/codemirror/mode/mbox/mbox.js'></script>
    <script src='node_modules/codemirror/mode/mirc/mirc.js'></script>
    <script src='node_modules/codemirror/mode/mllike/mllike.js'></script>
    <script src='node_modules/codemirror/mode/modelica/modelica.js'></script>
    <script src='node_modules/codemirror/mode/mscgen/mscgen.js'></script>
    <script src='node_modules/codemirror/mode/mumps/mumps.js'></script>
    <script src='node_modules/codemirror/mode/nginx/nginx.js'></script>

    <script src='node_modules/codemirror/mode/nsis/nsis.js'></script>

    <script src='node_modules/codemirror/mode/null/null.js'></script>

    <script src='node_modules/codemirror/mode/octave/octave.js'></script>
    <script src='node_modules/codemirror/mode/oz/oz.js'></script>
    <script src='node_modules/codemirror/mode/pascal/pascal.js'></script>
    <script src='node_modules/codemirror/mode/pegjs/pegjs.js'></script>
    <script src='node_modules/codemirror/mode/perl/perl.js'></script>
    <script src='node_modules/codemirror/mode/php/php.js'></script>
    <script src='node_modules/codemirror/mode/pig/pig.js'></script>
    <script src='node_modules/codemirror/mode/powershell/powershell.js'></script>
    <script src='node_modules/codemirror/mode/properties/properties.js'></script>
    <script src='node_modules/codemirror/mode/protobuf/protobuf.js'></script>
    <script src='node_modules/codemirror/mode/pug/pug.js'></script>
    <script src='node_modules/codemirror/mode/puppet/puppet.js'></script>
    <script src='node_modules/codemirror/mode/python/python.js'></script>
    <script src='node_modules/codemirror/mode/q/q.js'></script>
    <script src='node_modules/codemirror/mode/r/r.js'></script>
    <script src='node_modules/codemirror/mode/rpm/rpm.js'></script>
    <script src='node_modules/codemirror/mode/rst/rst.js'></script>
    <script src='node_modules/codemirror/mode/ruby/ruby.js'></script>
 
    <script src='node_modules/codemirror/mode/rust/rust.js'></script>
 
    <script src='node_modules/codemirror/mode/sas/sas.js'></script>
    <script src='node_modules/codemirror/mode/sass/sass.js'></script>
    <script src='node_modules/codemirror/mode/scheme/scheme.js'></script>
    <script src='node_modules/codemirror/mode/shell/shell.js'></script>
    <script src='node_modules/codemirror/mode/sieve/sieve.js'></script>
    <script src='node_modules/codemirror/mode/slim/slim.js'></script>
    <script src='node_modules/codemirror/mode/smalltalk/smalltalk.js'></script>
    <script src='node_modules/codemirror/mode/smarty/smarty.js'></script>
    <script src='node_modules/codemirror/mode/solr/solr.js'></script>
    <script src='node_modules/codemirror/mode/soy/soy.js'></script>
    <script src='node_modules/codemirror/mode/sparql/sparql.js'></script>
    <script src='node_modules/codemirror/mode/spreadsheet/spreadsheet.js'></script>
    <script src='node_modules/codemirror/mode/sql/sql.js'></script>
    <script src='node_modules/codemirror/mode/stex/stex.js'></script>
    <script src='node_modules/codemirror/mode/stylus/stylus.js'></script>
    <script src='node_modules/codemirror/mode/swift/swift.js'></script>
    <script src='node_modules/codemirror/mode/tcl/tcl.js'></script>
    <script src='node_modules/codemirror/mode/textile/textile.js'></script>
    <script src='node_modules/codemirror/mode/tiddlywiki/tiddlywiki.js'></script>
    <script src='node_modules/codemirror/mode/tiki/tiki.js'></script>
    <script src='node_modules/codemirror/mode/toml/toml.js'></script>
    <script src='node_modules/codemirror/mode/tornado/tornado.js'></script>
    <script src='node_modules/codemirror/mode/troff/troff.js'></script>
    <script src='node_modules/codemirror/mode/ttcn/ttcn.js'></script>
    <script src='node_modules/codemirror/mode/ttcn-cfg/ttcn-cfg.js'></script>
    <script src='node_modules/codemirror/mode/turtle/turtle.js'></script>
    <script src='node_modules/codemirror/mode/twig/twig.js'></script>
    <script src='node_modules/codemirror/mode/vb/vb.js'></script>
    <script src='node_modules/codemirror/mode/vbscript/vbscript.js'></script>
    <script src='node_modules/codemirror/mode/velocity/velocity.js'></script>
    <script src='node_modules/codemirror/mode/verilog/verilog.js'></script>
    <script src='node_modules/codemirror/mode/vhdl/vhdl.js'></script>
    <script src='node_modules/codemirror/mode/vue/vue.js'></script>

    <script src='node_modules/codemirror/mode/wast/wast.js'></script>

    <script src='node_modules/codemirror/mode/webidl/webidl.js'></script>
    <script src='node_modules/codemirror/mode/xml/xml.js'></script>
    <script src='node_modules/codemirror/mode/xquery/xquery.js'></script>
    <script src='node_modules/codemirror/mode/yacas/yacas.js'></script>
    <script src='node_modules/codemirror/mode/yaml/yaml.js'></script>
    <script src='node_modules/codemirror/mode/z80/z80.js'></script>
    
    
    
    

    
     <style>
        :root {
              --windowScaling: 1;
              --vw: 100vw;
              --vh: 100vh;
        }     
            
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: var(--body-background);
            color: var( --body-text);
            overflow: hidden;
        }  


        .outer-content {
            width: 100%;
            height: auto;
            margin-right: 10px;
            border:none;
        }


     
     </style>
        
    
    
    <style>   
        .CodeMirror { 
            line-height: 1.4; 
        }
        
        #view{
            padding-right: 18px;
            padding-left: 12px;
        }

        span.clicky {
          cursor: pointer;
          padding: 0 3px;
          border-style: solid;
          border-width: 1px;
          border-radius: 2px;
          border-color: var( --body-text);
          float: left;
          display: block;
          margin-right: 2px;
          position: relative;
        }
        
        #two-way{
            margin-left: 12px;
        }
        
                
        .enabled{
            background: white;
            color: black;
        }
        .disabled{
            background: white;
            color: gray;
        }
        
        
        span.checkbox {   
          float: left;
          display: block;
        }
        
        #up, #down, #align, #hide-unchanged{
          color: var( --body-text);
          border-color: var( --body-text);
        }
        
         #align{
          margin-left:20px;
        }  
             
        .CodeMirror-merge, .CodeMirror-merge .CodeMirror {
            height: calc(100vh / 0.5 - 86px ); 
        }
        
        .CodeMirror-merge-editor{
            border-style: solid;
            border-width: 1px;
            border-color: navy;
            border:none;
        }
        
        .CodeMirror-merge-scrolllock{
            visibility: collapse;  /* Hide */
        }
        
        .CodeMirror
        {
            background: var(--merge-body-background);
            color: var(--merge-color);
            border:none;
        }
        
        .CodeMirror-merge-gap, .CodeMirror-gutter,
        #editor2, #right2, 
        #editor3, #left3, #right3,
        .CodeMirror-linenumber  
        {
            background: var(--body-background);
            color: var(--body-text) !important;
            border:none;
        }
        
        #left3, #right3, #right2 {
            display:inline;
        }
        
        #left3_all {
            float:right;
        }
        
        #right3_all, #right2_all {
            float:left;
        }
    

        .CodeMirror-linenumber{
            padding-right: 5px !important;
            padding-left: 5px !important;
        }

        
        .CodeMirror-merge-copy{
            color: var(--merge-arrow);
        }
        
        .CodeMirror-merge-r-chunk
        {
            background-color: antiquewhite;
            fill: antiquewhite;
            stroke: antiquewhite;
        }  
        
        
        .CodeMirror-merge-r-chunk
        {
            background-color: var(--markerColor);
            fill: var(--markerColor);
            stroke: var(--markerColor);
        }     
        
        
        .CodeMirror-merge-r-connect
        {
            background: grey;
            fill: grey;
            stroke: grey;
        }        



  </style>
  


</head>


  <body class='light'>
    <!-- Dark mode on/off --> 
    <script>
        if (global.localState.dark){
            document.body.classList.remove('light');
            document.body.classList.add('dark');
        }
        
        let root = document.documentElement;
        root.style.setProperty('--windowScaling', global.state.zoom);
        
        
    </script>
    


    <div class="outer-content">
        <table id="Headers3" style="width:100%; visibility: collapse;">
            <tr>
                <td id="left3_" style="width:33%; text-align: center;">
                    <div id="left3">left</div> 
                    <button id="left3_all" onclick="addAllButtonClicked('left');" >all ⇝</button>
                </td>
                <td id="editor3" style="width:33%; text-align: center;">
                    center
                </td>
                <td id="right3_" style="width:33%; text-align: center;">
                    <div id="right3">right</div> 
                    <button id="right3_all" onclick="addAllButtonClicked('right');">⇜ all</button>
                </td>
            </tr>
        </table>
        
        
        <table id="Headers2" style="width:100%; visibility: collapse;">
            <tr>
                <td id="editor2" style="width:50%; text-align: center;">
                    left
                </td>
                <td id="right2_" style="width:50%; text-align: center;">
                    <div id="right2">right</div> 
                    <button id="right2_all"  onclick="addAllButtonClicked('right');">⇜ all</button>
                </td>
            </tr>
        </table>

        <div id="view"></div>
    </div>       
    
    
    <p style="margin-right: 10 px;"> 
        <div>
            <span id='two-way'    class=clicky onclick="panes = 2; initUI(true)">two-way</span>
            <span id='three-way'  class=clicky onclick="panes = 3; initUI(true)">three-way</span>

    
            <span class=checkbox>
                <input type="checkbox" id='align' class=clicky 
                    onclick="connect = connect ? null : 'align'; 
                        initUI(true);
                        obj = document.getElementById('theme-select');
                        themeSelected( obj.options[obj.selectedIndex].text);"
                > 
                <span id='align-text'>align</span>
                    
                <input type="checkbox" id='hide-unchanged'  class=clicky  
                    onclick="collapse = !collapse; 
                        initUI(true);
                        obj = document.getElementById('theme-select');
                        themeSelected( obj.options[obj.selectedIndex].text);"
                > 
                <span id='hide-unchanged-text'>hide unchanged</span>

                <!-- option = default is hard coded in code-mirror.css -->
                <!-- override by chunk-color, which specifies  alpha, or  html color -->
                <select id="theme-select" style="position: relative; left: 20px" 
                    onChange="initUI();themeSelected( this.options[this.selectedIndex].text);">
                    <option>default</option>
                    <option disabled>──────────</option>
                    <option chunk-color="0.25">zenburn</option>
                    <option chunk-color="0.25">3024-day</option>
                    <option chunk-color="0.25">3024-night</option>
                    <option chunk-color="0.25">abcdef</option>
                    <option chunk-color="0.25">ambiance</option>
                    <option chunk-color="0.25">ayu-dark</option>
                    <option chunk-color="0.25">ayu-mirage</option>
                    <option chunk-color="0.25">base16-dark</option>
                    <option chunk-color="0.25">base16-light</option>
                    <option chunk-color="0.25">bespin</option>
                    <option chunk-color="0.25">blackboard</option>
                    <option chunk-color="0.25">cobalt</option>
                    <option chunk-color="0.25">colorforth</option>
                    <option chunk-color="0.25">darcula</option>
                    <option chunk-color="0.25">dracula</option>
                    <option chunk-color="0.25">duotone-dark</option>
                    <option chunk-color="0.25">duotone-light</option>
                    <option chunk-color="antiquewhite">eclipse</option>
                    <option chunk-color="antiquewhite">elegant</option>
                    <option chunk-color="0.25">erlang-dark</option>
                    <option chunk-color="0.25">gruvbox-dark</option>
                    <option chunk-color="0.25">hopscotch</option>
                    <option chunk-color="0.25">icecoder</option>
                    <option chunk-color="antiquewhite">idea</option>
                    <option chunk-color="0.25">isotope</option>
                    <option chunk-color="0.25">liquibyte</option>
                    <option chunk-color="0.25">lucario</option>
                    <option chunk-color="0.25">material-darker</option>
                    <option chunk-color="0.25">material-ocean</option>
                    <option chunk-color="0.25">material-palenight</option>
                    <option chunk-color="0.25">material</option>
                    <option chunk-color="0.25">mbo</option>
                    <option chunk-color="0.25">mdn-like</option>
                    <option chunk-color="0.25">midnight</option>
                    <option chunk-color="0.25">monokai</option>
                    <option chunk-color="0.25">moxer</option>
                    <option chunk-color="antiquewhite">neat</option>
                    <option chunk-color="0.25">neo</option>
                    <option chunk-color="0.25">night</option>
                    <option chunk-color="0.25">nord</option>
                    <option chunk-color="0.25">oceanic-next</option>
                    <option chunk-color="0.25">panda-syntax</option>
                    <option chunk-color="0.25">paraiso-dark</option>
                    <option chunk-color="0.25">paraiso-light</option>
                    <option chunk-color="0.25">pastel-on-dark</option>
                    <option chunk-color="0.25">railscasts</option>
                    <option chunk-color="0.25">rubyblue</option>
                    <option chunk-color="0.25">seti</option>
                    <option chunk-color="0.25">shadowfox</option>
                    <option chunk-color="antiquewhite">solarized</option>
                    <option chunk-color="antiquewhite">ssms</option>
                    <option chunk-color="0.25">the-matrix</option>
                    <option chunk-color="0.25">tomorrow-night-bright</option>
                    <option chunk-color="0.25">tomorrow-night-eighties</option>
                    <option chunk-color="antiquewhite">ttcn</option>
                    <option chunk-color="0.25">twilight</option>
                    <option chunk-color="0.25">vibrant-ink</option>
                    <option chunk-color="0.25">xq-dark</option>
                    <option chunk-color="antiquewhite">xq-light</option>
                    <option chunk-color="#FCFAF8">yeti</option>
                    <option chunk-color="0.25">yonce</option>
                </select>            
                
            </span>
            
        </div>
        
        
        <div id='jump' style="position: absolute; left: 50%; bottom: 20px"> 
             <span id='down' class=clicky onclick="dv.edit.execCommand('goNextDiff');"> &#x25BC;</span> 
             <span id='up'   class=clicky onclick="dv.edit.execCommand('goPrevDiff');"> &#x25B2;</span> 
        </div>
        
        
        <button id="close" 
            onclick="finish('close');" 
            style="float: none;margin-right: 10px; visibility: collapse">
            Close
        </button>
        

        <button id="save" 
            onclick="finish('save');" 
            style="float: right;margin-right: 10px;">
            Save
        </button>
        
        
        <button id="cancel" 
            onclick="finish('cancel')" 
            style="float: right;margin-right: 10px;">
            Cancel
        </button>
        
                       
        <button id="reload" 
            onclick="initUI();" 
            style="float: right;margin-right: 10px;">
            Reload
        </button>
               
        
    </p>


 
    <!--  Onload, call javascript file  --> 
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {

            // Dialog if binary, otherwise open as usual
            if ( isBinaryFile() ){
                if ( getMode() == 'MERGE'){
                    document.getElementById('isBinaryMerge').showModal();
                }else if (getMode() == 'EDITOR'){
                    document.getElementById('isBinaryEditor').showModal();
                }else{
                    document.getElementById('isBinaryDiff').showModal();
                }
                
            }else{
                injectIntoJs(document);
            }
     
        });    
            
        window.addEventListener('unload', (event) => {
                console.log('merge.html :DOM fully unloaded -- maybe window closed ');
                if ( CLOSED == false){
                    finish('unloadWindow');
                }
            }
        );     
        
        
        var resizeTimer;
        
        window.addEventListener('resize',  update );
        function update(){
            initUI();
            themeSelected( global.state.pragmaMerge.codeTheme);
            
            

            clearTimeout(resizeTimer);
            resizeTimer = setTimeout( function() {
            
                // Run code here, resizing has "stopped"
                console.warn('resize stopped')
 
                // Scrollbars
                let scrollBars = document.getElementsByClassName('CodeMirror');
                for (var i = 0; i < scrollBars.length; ++i) {
                    scrollBars[i].style.overflowY = 'overflow';
                }
                        
            }, 250);
            
            
        }

        window.addEventListener("keydown", event => {
            if ( (event.ctrlKey || event.metaKey) && event.keyCode === 83 ){
                finish('save')
            }
        });
          
          
    </script>  
    
    <!--  Add find  -->    
    
    <script src="../node_modules/findinnw/dist/find-in-nw.js"></script>
    <script src="../extend_find-in-nw.js"></script>
    <script>
        findInNw.initialize();
        extendFindInNw(); // Make find-in-nw fit my purpose for graph and note and pragma-merge
        
        var pragmaMergeSearchInEditorId;  // This shows the active editor window to do the search in
    </script> 

        
        
         
    <!--  Dialog for Merging Binary files -->  
            
    <dialog id="isBinaryMerge"   class="warning"> 
         
        <b>WARNING</b> -- Looks like a binary file
            
        <br><br>
             
            <button style = "margin-top: 0px; margin-bottom: 8px;"
                onclick =  "parent.document.getElementById('iframe').contentWindow.keepThis()">
                Keep this 
            </button>   
            <sup>*</sup> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    
            
            <button  style = "float: right; margin-top: 0px; margin-bottom: 8px;"  
                onclick =  "parent.document.getElementById('iframe').contentWindow.keepOther();"> 
                Keep other
            </button> 
            

        <br> 
            <div class="footnoteText" > <sup>*</sup> (file from current local branch) </div>

        <hr>
        
            <button style = "margin-top: 8px; margin-bottom: 8px;" onclick =  "document.getElementById('isBinaryMerge').close(); injectIntoJs(document); " > 
                Interactive merge 
            </button>    
            (works best with text files)

    </dialog>  
    

         
    <!--  Dialog for Diff of Binary files -->       
                
    <dialog id="isBinaryDiff"   class="warning">  
        <b>WARNING</b> -- Looks like a binary file <br><br>(Cancel is the best option)
             
        <br><br>  
            <button style="float: right"  onclick = "parent.window.close();"> 
                Cancel
            </button>    
            
            <button  onclick = "document.getElementById('isBinaryDiff').close(); injectIntoJs(document); " > 
                View binary 
            </button>  
    </dialog>  
    
       

         
    <!--  Dialog for View/edit Binary files -->       
                
    <dialog id="isBinaryEditor"   class="warning">  
        <b>WARNING</b> -- Looks like a binary file <br><br> (Cancel is the best option)
             
        <br><br> 
            <button style="float: right"  onclick = "parent.window.close();"> 
                Cancel 
            </button>    
            
            <button  onclick = "document.getElementById('isBinaryEditor').close(); injectIntoJs(document); " > 
                View binary 
            </button>   
    </dialog> 
</body>    
</html>
