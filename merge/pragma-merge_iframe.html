<!DOCTYPE html> 
<html>
  <head>

    <meta name="viewport" content="user-scalable=1.0,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 

    <title id='title'>Merge/Diff</title>
    
    
    <link rel="stylesheet" href="node_modules/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="node_modules/codemirror/addon/merge/merge.css">
        

  
    <script src="node_modules/codemirror/lib/codemirror.js"></script>
    <script src="node_modules/codemirror/mode/meta.js"></script>   <!-- Used to map file-extension to mime-->    
    <script src="node_modules/diff-match-patch/index.js"></script>
    <script src="modified_codemirror_merge_addon.js"></script>
     
    <script src="pragma-merge.js"></script>
    <link rel="stylesheet" type="text/css" href="../color_styles.css" />   

    
    <!-- Read in all language modes-->    
    
    <script src="node_modules/codemirror/addon/mode/simple.js"></script>
    
    <script src="node_modules/codemirror/mode/xml/xml.js"></script>
    <script src="node_modules/codemirror/mode/css/css.js"></script>
    <script src="node_modules/codemirror/mode/javascript/javascript.js"></script>
    <script src="node_modules/codemirror/mode/htmlmixed/htmlmixed.js"></script>
    <script src="node_modules/codemirror/mode/clike/clike.js"></script>
    <script src="node_modules/codemirror/mode/octave/octave.js"></script>
    <script src="node_modules/codemirror/mode/python/python.js"></script>
        
        
    <script src='node_modules/codemirror/mode/apl/apl.js'></script>
    <script src='node_modules/codemirror/mode/asciiarmor/asciiarmor.js'></script>
    <script src='node_modules/codemirror/mode/asn.1/asn.1.js'></script>
    <script src='node_modules/codemirror/mode/asterisk/asterisk.js'></script>
    <script src='node_modules/codemirror/mode/brainfuck/brainfuck.js'></script>
    <script src='node_modules/codemirror/mode/clike/clike.js'></script>
    <script src='node_modules/codemirror/mode/clojure/clojure.js'></script>
    <script src='node_modules/codemirror/mode/cmake/cmake.js'></script>
    <script src='node_modules/codemirror/mode/cobol/cobol.js'></script>
    <script src='node_modules/codemirror/mode/coffeescript/coffeescript.js'></script>
    <script src='node_modules/codemirror/mode/commonlisp/commonlisp.js'></script>
    <script src='node_modules/codemirror/mode/crystal/crystal.js'></script>
    <script src='node_modules/codemirror/mode/css/css.js'></script>
    <script src='node_modules/codemirror/mode/cypher/cypher.js'></script>
    <script src='node_modules/codemirror/mode/d/d.js'></script>
    <script src='node_modules/codemirror/mode/dart/dart.js'></script>
    <script src='node_modules/codemirror/mode/diff/diff.js'></script>
    <script src='node_modules/codemirror/mode/django/django.js'></script>
    
    <script src='node_modules/codemirror/mode/dockerfile/dockerfile.js'></script>
    
    <script src='node_modules/codemirror/mode/dtd/dtd.js'></script>
    <script src='node_modules/codemirror/mode/dylan/dylan.js'></script>
    <script src='node_modules/codemirror/mode/ebnf/ebnf.js'></script>
    <script src='node_modules/codemirror/mode/ecl/ecl.js'></script>
    <script src='node_modules/codemirror/mode/eiffel/eiffel.js'></script>
    <script src='node_modules/codemirror/mode/elm/elm.js'></script>
    <script src='node_modules/codemirror/mode/erlang/erlang.js'></script>

    <script src='node_modules/codemirror/mode/factor/factor.js'></script>

    <script src='node_modules/codemirror/mode/fcl/fcl.js'></script>
    <script src='node_modules/codemirror/mode/forth/forth.js'></script>
    <script src='node_modules/codemirror/mode/fortran/fortran.js'></script>
    <script src='node_modules/codemirror/mode/gas/gas.js'></script>
    <script src='node_modules/codemirror/mode/gfm/gfm.js'></script>
    <script src='node_modules/codemirror/mode/gherkin/gherkin.js'></script>
    <script src='node_modules/codemirror/mode/go/go.js'></script>
    <script src='node_modules/codemirror/mode/groovy/groovy.js'></script>
    <script src='node_modules/codemirror/mode/haml/haml.js'></script>
    <script src='node_modules/codemirror/mode/haskell/haskell.js'></script>
    <script src='node_modules/codemirror/mode/haskell-literate/haskell-literate.js'></script>
    <script src='node_modules/codemirror/mode/haxe/haxe.js'></script>
    <script src='node_modules/codemirror/mode/htmlembedded/htmlembedded.js'></script>
    <script src='node_modules/codemirror/mode/htmlmixed/htmlmixed.js'></script>
    <script src='node_modules/codemirror/mode/http/http.js'></script>
    <script src='node_modules/codemirror/mode/idl/idl.js'></script>
    <script src='node_modules/codemirror/mode/javascript/javascript.js'></script>
    <script src='node_modules/codemirror/mode/jinja2/jinja2.js'></script>
    <script src='node_modules/codemirror/mode/jsx/jsx.js'></script>
    <script src='node_modules/codemirror/mode/julia/julia.js'></script>
    <script src='node_modules/codemirror/mode/livescript/livescript.js'></script>
    <script src='node_modules/codemirror/mode/lua/lua.js'></script>
    <script src='node_modules/codemirror/mode/markdown/markdown.js'></script>
    <script src='node_modules/codemirror/mode/mathematica/mathematica.js'></script>
    <script src='node_modules/codemirror/mode/mbox/mbox.js'></script>
    <script src='node_modules/codemirror/mode/mirc/mirc.js'></script>
    <script src='node_modules/codemirror/mode/mllike/mllike.js'></script>
    <script src='node_modules/codemirror/mode/modelica/modelica.js'></script>
    <script src='node_modules/codemirror/mode/mscgen/mscgen.js'></script>
    <script src='node_modules/codemirror/mode/mumps/mumps.js'></script>
    <script src='node_modules/codemirror/mode/nginx/nginx.js'></script>

    <script src='node_modules/codemirror/mode/nsis/nsis.js'></script>

    <script src='node_modules/codemirror/mode/null/null.js'></script>

    <script src='node_modules/codemirror/mode/octave/octave.js'></script>
    <script src='node_modules/codemirror/mode/oz/oz.js'></script>
    <script src='node_modules/codemirror/mode/pascal/pascal.js'></script>
    <script src='node_modules/codemirror/mode/pegjs/pegjs.js'></script>
    <script src='node_modules/codemirror/mode/perl/perl.js'></script>
    <script src='node_modules/codemirror/mode/php/php.js'></script>
    <script src='node_modules/codemirror/mode/pig/pig.js'></script>
    <script src='node_modules/codemirror/mode/powershell/powershell.js'></script>
    <script src='node_modules/codemirror/mode/properties/properties.js'></script>
    <script src='node_modules/codemirror/mode/protobuf/protobuf.js'></script>
    <script src='node_modules/codemirror/mode/pug/pug.js'></script>
    <script src='node_modules/codemirror/mode/puppet/puppet.js'></script>
    <script src='node_modules/codemirror/mode/python/python.js'></script>
    <script src='node_modules/codemirror/mode/q/q.js'></script>
    <script src='node_modules/codemirror/mode/r/r.js'></script>
    <script src='node_modules/codemirror/mode/rpm/rpm.js'></script>
    <script src='node_modules/codemirror/mode/rst/rst.js'></script>
    <script src='node_modules/codemirror/mode/ruby/ruby.js'></script>
 
    <script src='node_modules/codemirror/mode/rust/rust.js'></script>
 
    <script src='node_modules/codemirror/mode/sas/sas.js'></script>
    <script src='node_modules/codemirror/mode/sass/sass.js'></script>
    <script src='node_modules/codemirror/mode/scheme/scheme.js'></script>
    <script src='node_modules/codemirror/mode/shell/shell.js'></script>
    <script src='node_modules/codemirror/mode/sieve/sieve.js'></script>
    <script src='node_modules/codemirror/mode/slim/slim.js'></script>
    <script src='node_modules/codemirror/mode/smalltalk/smalltalk.js'></script>
    <script src='node_modules/codemirror/mode/smarty/smarty.js'></script>
    <script src='node_modules/codemirror/mode/solr/solr.js'></script>
    <script src='node_modules/codemirror/mode/soy/soy.js'></script>
    <script src='node_modules/codemirror/mode/sparql/sparql.js'></script>
    <script src='node_modules/codemirror/mode/spreadsheet/spreadsheet.js'></script>
    <script src='node_modules/codemirror/mode/sql/sql.js'></script>
    <script src='node_modules/codemirror/mode/stex/stex.js'></script>
    <script src='node_modules/codemirror/mode/stylus/stylus.js'></script>
    <script src='node_modules/codemirror/mode/swift/swift.js'></script>
    <script src='node_modules/codemirror/mode/tcl/tcl.js'></script>
    <script src='node_modules/codemirror/mode/textile/textile.js'></script>
    <script src='node_modules/codemirror/mode/tiddlywiki/tiddlywiki.js'></script>
    <script src='node_modules/codemirror/mode/tiki/tiki.js'></script>
    <script src='node_modules/codemirror/mode/toml/toml.js'></script>
    <script src='node_modules/codemirror/mode/tornado/tornado.js'></script>
    <script src='node_modules/codemirror/mode/troff/troff.js'></script>
    <script src='node_modules/codemirror/mode/ttcn/ttcn.js'></script>
    <script src='node_modules/codemirror/mode/ttcn-cfg/ttcn-cfg.js'></script>
    <script src='node_modules/codemirror/mode/turtle/turtle.js'></script>
    <script src='node_modules/codemirror/mode/twig/twig.js'></script>
    <script src='node_modules/codemirror/mode/vb/vb.js'></script>
    <script src='node_modules/codemirror/mode/vbscript/vbscript.js'></script>
    <script src='node_modules/codemirror/mode/velocity/velocity.js'></script>
    <script src='node_modules/codemirror/mode/verilog/verilog.js'></script>
    <script src='node_modules/codemirror/mode/vhdl/vhdl.js'></script>
    <script src='node_modules/codemirror/mode/vue/vue.js'></script>

    <script src='node_modules/codemirror/mode/wast/wast.js'></script>

    <script src='node_modules/codemirror/mode/webidl/webidl.js'></script>
    <script src='node_modules/codemirror/mode/xml/xml.js'></script>
    <script src='node_modules/codemirror/mode/xquery/xquery.js'></script>
    <script src='node_modules/codemirror/mode/yacas/yacas.js'></script>
    <script src='node_modules/codemirror/mode/yaml/yaml.js'></script>
    <script src='node_modules/codemirror/mode/z80/z80.js'></script>
    
    
    
    

    
     <style>
        :root {
              --windowScaling: 1;
              --vw: 100vw;
              --vh: 100vh;
        }     
            
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: var(--body-background);
            color: var( --body-text);
            overflow: hidden;
        }  


        .outer-content {
            width: 100%;
            height: auto;
            margin-right: 10px;
            border:none;
        }


     
     </style>
        
    
    
    <style>   
        .CodeMirror { 
            line-height: 1.4; 
        }
        
        #view{
            padding-right: 18px;
            padding-left: 12px;
        }

        span.clicky {
          cursor: pointer;
          padding: 0 3px;
          border-style: solid;
          border-width: 1px;
          border-radius: 2px;
          border-color: var( --body-text);
          float: left;
          display: block;
          margin-right: 2px;
          position: relative;
        }
        
        #two-way{
            margin-left: 12px;
        }
        
                
        .enabled{
            background: white;
            color: black;
        }
        .disabled{
            background: white;
            color: gray;
        }
        
        
        span.checkbox {   
          float: left;
          display: block;
        }
        
        #up, #down, #align, #hide-unchanged{
          color: var( --body-text);
          border-color: var( --body-text);
        }
        
         #align{
          margin-left:20px;
        }  
             
        .CodeMirror-merge, .CodeMirror-merge .CodeMirror {
            height: calc(100vh / 0.5 - 86px ); 
        }
        
        .CodeMirror-merge-editor{
            border-style: solid;
            border-width: 1px;
            border-color: navy;
            border:none;
        }
        
        .CodeMirror-merge-scrolllock{
            visibility: collapse;  /* Hide */
        }
        
        .CodeMirror
        {
            background: var(--merge-body-background);
            color: var(--merge-color);
            border:none;
        }
        
        .CodeMirror-merge-gap, .CodeMirror-gutter,
        #editor2, #right2, 
        #editor3, #left3, #right3,
        .CodeMirror-linenumber  
        {
            background: var(--body-background);
            color: var(--body-text) !important;
            border:none;
        }
        
        #left3, #right3, #right2 {
            display:inline;
        }
        
        #left3_all {
            float:right;
        }
        
        #right3_all, #right2_all {
            float:left;
        }
    

        .CodeMirror-linenumber{
            padding-right: 5px !important;
            padding-left: 5px !important;
        }

        
        .CodeMirror-merge-copy{
            color: var(--merge-arrow);
        }
        
        .CodeMirror-merge-r-chunk,
        .CodeMirror-merge-l-chunk
        {
            background-color: antiquewhite;
            fill: antiquewhite;
            stroke: antiquewhite;
        }  
        
        
        .CodeMirror-merge-r-chunk
        .CodeMirror-merge-l-chunk
        {
            background-color: var(--markerColor);
            fill: var(--markerColor);
            stroke: var(--markerColor);
        }     
        
        
        .CodeMirror-merge-r-connect,
        .CodeMirror-merge-l-connect
        {
            background: grey;
            fill: grey;
            stroke: grey;
        }        



  </style>
  


</head>


  <body class='light'>
    <!-- Dark mode on/off --> 
    <script>
        if (global.localState.dark){
            document.body.classList.remove('light');
            document.body.classList.add('dark');
        }
        
        let root = document.documentElement;
        root.style.setProperty('--windowScaling', global.state.zoom);
        
        
    </script>
    


    <div class="outer-content">
        <table id="Headers3" style="width:100%; visibility: collapse;">
            <tr>
                <td id="left3_" style="width:33%; text-align: center;">
                    <div id="left3">left</div> 
                    <button id="left3_all" onclick="addAllButtonClicked('left');" >all ⇝</button>
                </td>
                <td id="editor3" style="width:33%; text-align: center;">
                    center
                </td>
                <td id="right3_" style="width:33%; text-align: center;">
                    <div id="right3">right</div> 
                    <button id="right3_all" onclick="addAllButtonClicked('right');">⇜ all</button>
                </td>
            </tr>
        </table>
        
        
        <table id="Headers2" style="width:100%; visibility: collapse;">
            <tr>
                <td id="editor2" style="width:50%; text-align: center;">
                    left
                </td>
                <td id="right2_" style="width:50%; text-align: center;">
                    <div id="right2">right</div> 
                    <button id="right2_all"  onclick="addAllButtonClicked('right');">⇜ all</button>
                </td>
            </tr>
        </table>

        <div id="view"></div>
    </div>       
    
    
    <p style="margin-right: 10 px;"> 
        <div>
            <span id='two-way'    class=clicky onclick="panes = 2; initUI(true)">two-way</span>
            <span id='three-way'  class=clicky onclick="panes = 3; initUI(true)">three-way</span>

    
            <span class=checkbox>
                <input type="checkbox" id='align' class=clicky 
                    onclick="connect = connect ? null : 'align'; 
                        initUI(true);
                        obj = document.getElementById('theme-select');
                        themeSelected( obj.options[obj.selectedIndex].text);"
                > 
                <span id='align-text'>align</span>
                    
                <input type="checkbox" id='hide-unchanged'  class=clicky  
                    onclick="collapse = !collapse; 
                        initUI(true);
                        obj = document.getElementById('theme-select');
                        themeSelected( obj.options[obj.selectedIndex].text);"
                > 
                <span id='hide-unchanged-text'>hide unchanged</span>

                <!-- option = default is hard coded in code-mirror.css -->
                <!-- override by chunk-color, which specifies  alpha, or  html color -->
                <select id="theme-select" style="position: relative; left: 20px" 
                    onChange="initUI();themeSelected( this.options[this.selectedIndex].text);">
                    <option>default</option>
                    <option disabled>──────────</option>
                    <option chunk-color="0.25">zenburn</option>
                    <option chunk-color="0.25">3024-day</option>
                    <option chunk-color="0.25">3024-night</option>
                    <option chunk-color="0.25">abcdef</option>
                    <option chunk-color="0.25">ambiance</option>
                    <option chunk-color="0.25">ayu-dark</option>
                    <option chunk-color="0.25">ayu-mirage</option>
                    <option chunk-color="0.25">base16-dark</option>
                    <option chunk-color="0.25">base16-light</option>
                    <option chunk-color="0.25">bespin</option>
                    <option chunk-color="0.25">blackboard</option>
                    <option chunk-color="0.25">cobalt</option>
                    <option chunk-color="0.25">colorforth</option>
                    <option chunk-color="0.25">darcula</option>
                    <option chunk-color="0.25">dracula</option>
                    <option chunk-color="0.25">duotone-dark</option>
                    <option chunk-color="0.25">duotone-light</option>
                    <option chunk-color="antiquewhite">eclipse</option>
                    <option chunk-color="antiquewhite">elegant</option>
                    <option chunk-color="0.25">erlang-dark</option>
                    <option chunk-color="0.25">gruvbox-dark</option>
                    <option chunk-color="0.25">hopscotch</option>
                    <option chunk-color="0.25">icecoder</option>
                    <option chunk-color="antiquewhite">idea</option>
                    <option chunk-color="0.25">isotope</option>
                    <option chunk-color="0.25">liquibyte</option>
                    <option chunk-color="0.25">lucario</option>
                    <option chunk-color="0.25">material-darker</option>
                    <option chunk-color="0.25">material-ocean</option>
                    <option chunk-color="0.25">material-palenight</option>
                    <option chunk-color="0.25">material</option>
                    <option chunk-color="0.25">mbo</option>
                    <option chunk-color="0.25">mdn-like</option>
                    <option chunk-color="0.25">midnight</option>
                    <option chunk-color="0.25">monokai</option>
                    <option chunk-color="0.25">moxer</option>
                    <option chunk-color="antiquewhite">neat</option>
                    <option chunk-color="0.25">neo</option>
                    <option chunk-color="0.25">night</option>
                    <option chunk-color="0.25">nord</option>
                    <option chunk-color="0.25">oceanic-next</option>
                    <option chunk-color="0.25">panda-syntax</option>
                    <option chunk-color="0.25">paraiso-dark</option>
                    <option chunk-color="0.25">paraiso-light</option>
                    <option chunk-color="0.25">pastel-on-dark</option>
                    <option chunk-color="0.25">railscasts</option>
                    <option chunk-color="0.25">rubyblue</option>
                    <option chunk-color="0.25">seti</option>
                    <option chunk-color="0.25">shadowfox</option>
                    <option chunk-color="antiquewhite">solarized</option>
                    <option chunk-color="antiquewhite">ssms</option>
                    <option chunk-color="0.25">the-matrix</option>
                    <option chunk-color="0.25">tomorrow-night-bright</option>
                    <option chunk-color="0.25">tomorrow-night-eighties</option>
                    <option chunk-color="antiquewhite">ttcn</option>
                    <option chunk-color="0.25">twilight</option>
                    <option chunk-color="0.25">vibrant-ink</option>
                    <option chunk-color="0.25">xq-dark</option>
                    <option chunk-color="antiquewhite">xq-light</option>
                    <option chunk-color="#FCFAF8">yeti</option>
                    <option chunk-color="0.25">yonce</option>
                </select>            
                
            </span>
            
        </div>
        
        
        <div id='jump' style="position: absolute; left: 50%; bottom: 20px"> 
             <span id='down' class=clicky onclick="dv.edit.execCommand('goNextDiff');"> &#x25BC;</span> 
             <span id='up'   class=clicky onclick="dv.edit.execCommand('goPrevDiff');"> &#x25B2;</span> 
        </div>
        
        
        <button id="close" 
            onclick="finish('close');" 
            style="float: none;margin-right: 10px; visibility: collapse">
            Close
        </button>
        

        <button id="save" 
            onclick="finish('save');" 
            style="float: right;margin-right: 10px;">
            Save
        </button>
        
        
        <button id="cancel" 
            onclick="finish('cancel')" 
            style="float: right;margin-right: 10px;">
            Cancel
        </button>
        
                       
        <button id="reload" 
            onclick="initUI();" 
            style="float: right;margin-right: 10px;">
            Reload
        </button>
               
        
    </p>


 
    <!--  Onload, call javascript file  --> 
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {

            // Dialog if binary, otherwise open as usual
            if ( isBinaryFile() ){
                if ( getMode() == 'MERGE'){
                    document.getElementById('isBinaryMerge').showModal();
                }else if (getMode() == 'EDITOR'){
                    document.getElementById('isBinaryEditor').showModal();
                }else{
                    document.getElementById('isBinaryDiff').showModal();
                }
                
            }else{
                injectIntoJs(document);
            }
     
        });    
            
        window.addEventListener('unload', (event) => {
                console.log('merge.html :DOM fully unloaded -- maybe window closed ');
                if ( CLOSED == false){
                    finish('unloadWindow');
                }
            }
        );     
        
        
        var resizeTimer;
        
        window.addEventListener('resize',  update );
        function update(){
            initUI();
            themeSelected( global.state.pragmaMerge.codeTheme);
            
            

            clearTimeout(resizeTimer);
            resizeTimer = setTimeout( function() {
            
                // Run code here, resizing has "stopped"
                console.warn('resize stopped')
 
                // Scrollbars
                let scrollBars = document.getElementsByClassName('CodeMirror');
                for (var i = 0; i < scrollBars.length; ++i) {
                    scrollBars[i].style.overflowY = 'overflow';
                }
                        
            }, 250);
            
            
        }

        window.addEventListener("keydown", event => {
            if ( (event.ctrlKey || event.metaKey) && event.keyCode === 83 ){
                finish('save')
            }
        });
          
          
    </script>  
    
    
    <!--              -->     
    <!--  Add Search  -->  
    <!--              -->    

    <script src="node_modules/codemirror/addon/search/searchcursor.js"></script>
<!--
    <link rel="stylesheet" href="node_modules/codemirror/addon/dialog/dialog.css">
    <link rel="stylesheet" href="node_modules/codemirror/addon/search/matchesonscrollbar.css">  
      
    <script src="node_modules/codemirror/addon/dialog/dialog.js"></script>
    <script src="node_modules/codemirror/addon/search/search.js"></script> 
    <script src="node_modules/codemirror/addon/scroll/annotatescrollbar.js"></script>
    <script src="node_modules/codemirror/addon/search/matchesonscrollbar.js"></script>
    <script src="node_modules/codemirror/addon/search/jump-to-line.js"></script>
-->
    
     <!--CSS for marked text -->
    <style>
        .cm-all {
          background-color: yellow; /* Change to your desired color */
          color: black!important; /* Change to your desired text color */
        }
        .cm-searching {
          background-color: #38d878; /* Change to your desired color */
          color: black!important; /* Change to your desired text color */
        }
    </style>
    
    
    <script>        
        
        // Variables
            var count = 0;
            
            var searchCursor;
            var resultCounter = 0; // Number of found items
            var mark;           // Variable to store the MarkText object
            var marks = [];
            var openEditor;     // Variable to store the editor 
            var pragmaMergeSearchInEditorId;  // This shows the active editor window to do the search in
        
        // Open Search Dialog
            positionSearchBoxPragmaMerge = function (){
                
                // Clear selection that remains after previous searching
                try{
                    let cursorPos = openEditor.getCursor();
                    openEditor.setSelection({line: cursorPos.line, ch: 0});
                }catch (err){
                    // There was no selection (maybe first search))
                }
                
                // Clear count values
                count = 0;
                resultCounter = 0;
                updateNumbers();
                openEditor = getEditor(); 
                
                // Open empty searchbox
                document.getElementById('find-in-nw-search-box').classList.add('find-in-nw-search-box-visible');
                
                // Set position getting editor from variable 'pragmaMergeSearchInEditorId' as defined on mouse click on search icon
                let leftPos = document.getElementsByClassName(pragmaMergeSearchInEditorId)[0].getBoundingClientRect().x + 40;
                document.getElementById('find-in-nw-search-box').style.left = leftPos + 'px';
                document.getElementById('find-in-nw-search-box').style.right = 'auto';
                document.getElementById('find-in-nw-search-box').style.top = '-6px';

                // Cursor in input field
                document.getElementById('find-in-nw-input').focus();
                
                // New search
                let query =  document.getElementById('find-in-nw-input').value;
                newSearch( query)
            }
     
        // Close Search Dialog
            function closeSearchDialog(){
                // The search phrase remains if not closed (but opened searchbox for second editor -- this is a feature, not a bug)
                
                if (mark) {
                  mark.clear();
                }
                
                if (marks){
                    for (var i = 0; i < marks.length; i++) { 
                        marks[i].clear();
                    }
                    
                }
                
                document.getElementById('find-in-nw-search-box').classList.remove('find-in-nw-search-box-visible');
                document.getElementById('find-in-nw-input').value = ''; 
              
                // Clear count values
                count = 0;
                resultCounter = 0;
                updateNumbers();
                
                // Clear query
                query = '';
                
                // Clear selection, that remains at last mark
                let cursorPos = openEditor.getCursor();
                openEditor.setSelection({line: cursorPos.line, ch: 0});
            }
            
         
        // Search 
            function newSearch( query){
                caseInsensitive = true;
                
                
                if (mark) {
                  mark.clear();
                }
                
                if (marks){
                    for (var i = 0; i < marks.length; i++) { 
                        marks[i].clear();
                    }
                    
                }
                
                // Search 1 -- Loop result
                searchCursor = openEditor.getSearchCursor(query, 0, caseInsensitive); 
                
                resultCounter = 0;
                while (searchCursor.findNext()) {
                    resultCounter++; 
                    
                    // Mark all
                    let mark = openEditor.markText(searchCursor.from(), searchCursor.to(), {className: "cm-all"});
                    marks.push(mark);
                }
 
                // Same search again -- use result
                searchCursor = openEditor.getSearchCursor(query, 0, caseInsensitive); 
                
                // Update display
                count = -1;  
                nextClicked();
                updateNumbers();

            }
        
        // Set editor (to do search on)          
            function getEditor(){
                editor = dv.edit;
                if (pragmaMergeSearchInEditorId == 'CodeMirror-merge-right') {
                    editor = dv.right.orig;
                }
                if (pragmaMergeSearchInEditorId == 'CodeMirror-merge-left') {
                    editor = dv.left.orig;
                }
                return editor
            }
        
        // Next result
            function nextClicked() {
                // Bail out if at last item
                if ( ( count + 1 ) >= resultCounter ){
                    return
                }
                
                // Clear mark
                if ( mark ) {
                  mark.clear();
                }
                
                // Go to next
                if (searchCursor.findNext()) {
                  count++;
                  editor.setSelection(searchCursor.from(), searchCursor.to());
                  mark = editor.markText(searchCursor.from(), searchCursor.to(), {className: "cm-searching"});
                } 
                
                updateNumbers();
            }
            
        // Previous result
            function prevClicked() {
                
                // Bail out if at first item
                if ( count <= 0  ){
                    return
                }
                
                // Clear mark
                if ( mark ) {
                  mark.clear();
                }
        
                // Go to previous 
                if (searchCursor.findPrevious()) {
                  count--;
                  editor.setSelection(searchCursor.from(), searchCursor.to());
                  mark = editor.markText(searchCursor.from(), searchCursor.to(), {className: "cm-searching"});
                } 
                
                updateNumbers();
            }    
        
        // Update display
            function updateNumbers(){
                
                // count is zero-based, make 1 lowest value
                let countValue = count + 1;
                
                // If empty query -- display 0
                let query =  document.getElementById('find-in-nw-input').value;
                if (query == ''){
                    countValue = 0;
                }
                
                
                document.getElementById("find-in-nw-current").innerText = countValue;  
                document.getElementById("find-in-nw-count").innerText = resultCounter;
            }
            
            
        // Key press in search-field   Pragma-merge -- Find input takes keys ∧ ∨ ESC 
            function searchFormKeyDown(element, evt){
                console.log('Pressed Key in Search = ' + evt.key + '   evt.keyCode = ' + evt.keyCode );
                if (evt.keyCode == 13){
                    let query = element.value;
                    newSearch(query);
                }
                if ( evt.keyCode === 40 ){
                    nextClicked();
                }
                if ( evt.keyCode === 38 ){
                    prevClicked();
                }            
                if (evt.keyCode === 27) {
                    closeSearchDialog();
                }

            }

        
    </script>
 
 
    <!-- Copied html from a window using findinnw-->
       
    <div id="find-in-nw-search-box" class="find-in-nw-search-box"  style="z-index: 1000000; left: 53px; right: auto; top: -6px;">
        
        <input id="find-in-nw-input" class="find-in-nw-input" placeholder="Find text ... [ENTER]"  onclick="newSearch(this.value)" onKeyDown="searchFormKeyDown(this, event)">
        
        <span id="find-in-nw-current" class="find-in-nw-current">0</span>
        <span id="find-in-nw-of" class="find-in-nw-of">/</span>
        <span id="find-in-nw-count" class="find-in-nw-count">0</span>
        
        <button id="find-in-nw-previous" class="find-in-nw-previous" onclick="prevClicked()" >∧</button>
        <button id="find-in-nw-next" class="find-in-nw-next" onclick="nextClicked()" >∨</button>
        
        <button id="find-in-nw-close" class="find-in-nw-close" onclick="closeSearchDialog()" >  × </button>
    </div>
    
    
    <!-- Copied html from a window using findinnw-->
    
    <style id="find-in-nw-style">
        .find-in-nw-search-box{position:fixed;top:10px;right:10px;display:none;width:300px;background:#f1f1f1;border:1px solid #c1c1c1;border-radius:7px;margin:0px;padding:0px;box-shadow:1px 3px 9px rgba(0,0,0,.6)}
        .find-in-nw-search-box-visible{display:flex;}
        .find-in-nw-input{flex-grow:1;width:100%;background:transparent;border:0px;margin:0px;padding:0px 0px 0px 3px;font-size:16px}
        .find-in-nw-previous,.find-in-nw-next,.find-in-nw-close{width:32px;background:transparent;border:0px;margin:0px 5px 0px 0px;padding:0px;font-size:32px;opacity:.5}
        .find-in-nw-previous:hover,.find-in-nw-next:hover,.find-in-nw-close:hover{opacity:1}
        .find-in-nw-search-box,.find-in-nw-input,.find-in-nw-count,.find-in-nw-previous,.find-in-nw-next,.find-in-nw-close{height:32px;color:#000;font-family:sans-serif;line-height:32px;vertical-align:top}
        .find-in-nw-input:focus,.find-in-nw-previous:focus,.find-in-nw-next:focus,.find-in-nw-close:focus{opacity:1;outline:none}
        .find-in-nw-previous,.find-in-nw-next{font-size:30px;transform:scale(1.5, 0.7)}
        .find-in-nw-count{margin-right:8px}
        .find-in-nw-token{background-color:#ff0}
        .find-in-nw-current-token{background:#38d878;color:#fff}
    </style>         
         
         
         
         
         
    <!--  Dialog for Merging Binary files -->  
            
    <dialog id="isBinaryMerge"   class="warning"> 
         
        <b>WARNING</b> -- Looks like a binary file
            
        <br><br>
             
            <button style = "margin-top: 0px; margin-bottom: 8px;"
                onclick =  "parent.document.getElementById('iframe').contentWindow.keepThis()">
                Keep this 
            </button>   
            <sup>*</sup> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    
            
            <button  style = "float: right; margin-top: 0px; margin-bottom: 8px;"  
                onclick =  "parent.document.getElementById('iframe').contentWindow.keepOther();"> 
                Keep other
            </button> 
            

        <br> 
            <div class="footnoteText" > <sup>*</sup> (file from current local branch) </div>

        <hr>
        
            <button style = "margin-top: 8px; margin-bottom: 8px;" onclick =  "document.getElementById('isBinaryMerge').close(); injectIntoJs(document); " > 
                Interactive merge 
            </button>    
            (works best with text files)

    </dialog>  
    

         
    <!--  Dialog for Diff of Binary files -->       
                
    <dialog id="isBinaryDiff"   class="warning">  
        <b>WARNING</b> -- Looks like a binary file <br><br>(Cancel is the best option)
             
        <br><br>  
            <button style="float: right"  onclick = "parent.window.close();"> 
                Cancel
            </button>    
            
            <button  onclick = "document.getElementById('isBinaryDiff').close(); injectIntoJs(document); " > 
                View binary 
            </button>  
    </dialog>  
    
       

         
    <!--  Dialog for View/edit Binary files -->       
                
    <dialog id="isBinaryEditor"   class="warning">  
        <b>WARNING</b> -- Looks like a binary file <br><br> (Cancel is the best option)
             
        <br><br> 
            <button style="float: right"  onclick = "parent.window.close();"> 
                Cancel 
            </button>    
            
            <button  onclick = "document.getElementById('isBinaryEditor').close(); injectIntoJs(document); " > 
                View binary 
            </button>   
    </dialog> 
</body>    
</html>
